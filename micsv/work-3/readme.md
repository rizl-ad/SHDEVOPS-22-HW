# Решение ДЗ к занятию «Микросервисы: подходы»

## Задача 1: Обеспечить разработку

Для крупной компании, строящей систему на основе микросервисной архитектуры наиболее подходящим CI/CD-решением является GitLab.   
Данное решение отлично подойдет компаниям стремящимся к единым процессам, централизованному управлению, контролю над инфраструктурой и корпоративной стандартизации. GitLab позволяет следовать данным философиям, соответствует всем заявленным требованиям и является полноценной all-in-one DevOps-платформой, включающий следующие компоненты:
- Git
- CI/CD
- Docker Registry
- Infrastructure-as-Code
- Security scanning
- Code review + Issue tracking
- Wiki
- Observability
- Kubernetes management
- Dependency proxy

Решение можно было бы построить на основе таких продуктов как GitHub и Jenkins, но GitLab в сравнении с ними:
- это единая платформа;
- лучше масштабируется на большое количество сервисов и команд;
- предоставляет более строгий контроль безопасности;
- имеет встроенный контейнерный реестр и DevSecOps;
- удобнее для управления корпоративной структурой;
- проще стандартизировать процессы разработки на уровне всей компании.

## Задача 2: Логи

Предлагаемое решение: Vector + Kafka + Elasticsearch + Kibana.

### **Vector**.

Обеспечивает:
- сбор логов из JSON-файлов, куда Docker/Kubernetes сохраняют stdout, процесс осуществляется без необходимости модификации приложений;
- буферизацию логов на диск, т.о. при сбоях сети данные не теряются;
- отправку логов в Kafka.

Выбор сделан в пользу Vector, т.к. он потребляет минимальное количество ресурсов и имеет высокую скорость работы, что обеспечивает высокопроизводительный сбор логов и минимизацию вероятности аффекта на сервисы.

### **Kafka**.

Ключевой компонент, обеспечивающий в связке с буферизацией Vector гарантированную доставку логов до центрального хранилища.

В предыдущем ДЗ мы определили что для крупной компании, строящей систему на основе микросервисной архитектуры, с учётом всех перечисленных требований, оптимальным выбором будет Apache Kafka.

### **Elasticsearch**.

Обеспечивает:
- централизованное хранение логов;
- поиск и фильтрации по записям логов.

Почему Elasticsearch:
- де-факто стандарт лог-хранилищ;
- быстрый полнотекстовый поиск;
- лёгкое масштабирование при росте количества микросервисов;
- богатая система индексов и ротации.

### **Kibana**.

Обеспечивает:
- пользовательский интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Почему Kibana:
- native UI для Elasticsearch;
- фильтры, визуализации, полнотекстовый поиск, live-tail, saved searches;
- возможность делиться ссылками на saved searches.

## Задача 3: Мониторинг

Оптимальным решением для целей мониторинга сервисов на основе микросервисной архитектуры является стек (node exporter + kubelet/cAdvisor + vmagent) + VictoriaMetrics + Grafana.

### **node exporter**

Обеспечивает сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network.

### **kubelet и cAdvisor**

Обеспечивают сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network.

### **vmagent**

Агрегирует метрики со всех источников и отправляет их в центральное хранилище.

Почему vmagent:
- более быстрый и лёгкий аналог Prometheus.

### **VictoriaMetrics**

Обеспечивает централизованное хранение метрик.

Почему VictoriaMetrics:
- в отличии от Prometheus легко масштабируется горизонтально - позволяет наращивать объём данных и нагрузку добавлением новых нод;
- cамое высокое сжатие метрик в сравнении с аналогами;
- в сравнении с Prometheus более производительный и потребляет меньше ресурсов;
- совместим с экосистемой Prometheus;
- полная HA;
- долговременное хранение.

### **Grafana**

Обеспечивает:
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Возможные альтернативы есть (например Chronograf, Kibana), но ни одна из них не даёт такой же гибкости, нативной поддержки PromQL и простоты интеграции с VictoriaMetrics, как Grafana.

## Задача 4: Логи *

[Проект docker compose](https://github.com/rizl-ad/SHDEVOPS-22-HW/tree/main/micsv/work-3/task4)

Скрин результата:

<img width="903" height="563" alt="t3_1" src="https://github.com/user-attachments/assets/43ab3de6-2a5a-46d0-b57e-def28139553d" />

## Задача 5: Мониторинг *

[Проект docker compose](https://github.com/rizl-ad/SHDEVOPS-22-HW/tree/main/micsv/work-3/task5)

Скрин результата:

<img width="904" height="561" alt="t5_1" src="https://github.com/user-attachments/assets/b3246dca-c3ec-420b-8679-f68ec390be42" />

