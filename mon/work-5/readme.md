# Решение ДЗ к занятию 17 «Инцидент-менеджмент»

Описание инцидента: https://github.blog/news-insights/company-news/oct21-post-incident-analysis/

## Постмортем

|  |  |
| --- | --- |
| Краткое описание инцидента | 21 октября 2018 г. 22:54 UTC внутренние системы мониторинга GitHub начали генерировать оповещения о многочисленных сбоях в работе систем, вызванных split-brain кластеров MySQL. |
| Причина инцидента | 1. Разделение сети между восточным и западным ЦОД, возникшее 21 октября в 22:52 UTC, вызванное плановыми работами по замене вышедшего из строя оптического оборудования 100G.<br>2. Задержка передачи данных между региональными ЦОД. |
| Воздействие | Отображение на сайте GitHub не актуальных данных, недоступность функционала вебхуков и сборки страниц, задержки отклика от сайта. |
| Обнаружение | Дежурными инженерами через сиситему мониторинга. |
| Реакция | Инженеры группы реагирования восстановили полную работоспособность сайта за 24 часа и 11 минут. |
| Восстановление | 1. Восстановление данные из резервных копий.<br>2. Синхронизация реплики на обоих сайтах.<br>3. Возврат к стабильной топологии обслуживания.<br>4. Возобновление функций сайта. |
| Таймлайн | `21.10 22:52` – разделение сети, Orchestrator, потеряв связь с мастером кластера восточного ЦОД инициировал выборы нового мастера в западном ЦОД<br>`Через 43 секунды` – связь между разделенными частями сети восстановилась.<br>`21.10 22:54` – появление оповещений о сбоях в системе мониторинга.<br>`21.10 23:02` – инженеры группы реагирования определили, что топологии кластеров баз данных находятся в непредвиденном состоянии.<br>`21.10 23:07` – команда реагирования заблокировала внутренние инструменты развертывания, чтобы предотвратить внесение каких-либо изменений.<br>`21.10 23:09` – команда реагирования перевела сайт в жёлтый статус.<br>`21.10 23:11` – к решению инцидента присоединился координатор.<br>`21.10 23:13` – координатор инцидента изменил статус на красный, вызваны дополнительные инженеры из команды разработчиков баз данных GitHub.<br>`21.10 23:19` – в целях сохранения целостности имеющихся данных принято решение снизить удобство использования сайта, приостановив доставку вебхуков и сборку GitHub Pages.<br>`22.10 00:05` – инженеры группы реагирования приступили к разработке плана устранения несоответствий данных и внедрения процедур аварийного переключения MySQL, обновлен статус инцидента для пользователей.<br>`22.10 00:41` – запущен процесс восстановления всех затронутых кластеров MySQL из резервных копий.<br>`22.10 06:51` – завершено восстановление несколько кластеров в центре обработки данных, начата репликация новых данных с западного ЦОД.<br>`22.10 07:46` – обновлен статус инцидента для пользователей – дан прогноз срока восстановления.<br>`22.10 11:12` – роль мастера всех кластеров возвращена в восточный ЦОД.<br>`22.10 13:15` – организованы дополнительные реплики для чтения в целях снижения задержек репликации.<br>`22.10 16:24` – выполнено аварийное переключение на исходную топологию, возобновлена обработка вебхуков и сборка GitHub Pages.<br>`22.10 16:24` – приняты меры для балансировки возросшей нагрузки, увеличен TTL обработки данных.<br>`22.10 23:03` – очередь вебхуков и сборок страниц обработана, целостность и корректная работа систем восстановлена, статус сайта обновлён до зелёного. |
| Последующие действия | Восстановление данных, записанных Восточным ЦОД и не реплицированных на сайт западного ЦОД во время разделения сети.<br>Изменение конфигурации Orchestrator в целях предотвращения распространение мастеров базы данных за пределы региональных ЦОД. |
