# Решение [ДЗ к занятию «Troubleshooting»](https://github.com/netology-code/kuber-homeworks/blob/main/3.5/3.5.md)

## Задание. При деплое приложение web-consumer не может подключиться к auth-db. Необходимо это исправить

Не смотря на указание в задании на проблему с подключением к сервису auth-db, у приложения существует еще одна проблема - поды деплоймента web-consumer не стартуют со статусом CrashLoopBackOff. Эта проблема обусловлена следующими факторами:
- образ `radial/busyboxplus:curl` не является актуальным, т.к. его последняя публикация сделана более 10 лет назад; 
- образ `radial/busyboxplus:curl` содержит жестко заданную символическую ссылку для файла /etc/resolv.conf, которая указывает на несуществующий путь внутри образа;
- со времени последней публикации образа в архитектуре Kubernetes и способах управления файловой системой контейнеров произошли существенные изменения.

Когда Kubernetes пытается смонтировать актуальные настройки DNS в этот файл, операция завершается ошибкой, так как целевой путь ссылки недоступен.   

Для того чтобы убедиться в проблеме с символической ссылкой мы можем найти загруженный контейнер в K8s:   

Далее смонтировать контейнер во временный каталог:   

И убедиться что символическая ссылка указывает на несуществующий файл:   


Данную проблему можно решить пересозданием файла /etc/resolv.conf внутри образа при помощи docker, сохранением исправленн образ в какое-либо registry и использованием в deployment исправленного образа.   
Но гораздо проще взять изначально рабочий актуальный образ, например curlimages/curl - как мы и поступили.

Вернемся к проблеме непосредственно задания - к проблеме доступа приложения web-consumer к auth-db.
Данная проблема связана с тем, что приложение и сервис находятся в разных namespace - приложение web-consumer в namespace `web`, а сервис и приложение auth-db в `data`.   
В K8s можно обращаться к сервису в другом namespace, используя или его полное доменное имя (FQDN) в формате, например, auth-db.data.svc.cluster.local, или сокращенное имя, например, auth-db.data. Это стандартный способ межпространственного взаимодействия в кластере, который обеспечивается CoreDNS K8s. 


Скорректированная [YAML-конфигурация]()


